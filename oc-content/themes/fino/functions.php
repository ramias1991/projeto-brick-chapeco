<?php/* * Copyright 2017 osclass-pro.com * * You shall not distribute this theme and any its files (except third-party libraries) to third parties. * Rental, leasing, sale and any other form of distribution are not allowed and are strictly forbidden. */    define('FINO_THEME_VERSION', '2.9.3');	    function fino_region_select() {        View::newInstance()->_exportVariableToView('list_regions', Search::newInstance()->listRegions('%%%%', '>=', 'region_name ASC') ) ;        if( osc_count_list_regions() > 0 ) {            echo '<select id="sRegion" name="sRegion">' ;			echo '<option value="">' . __('Select a region', 'fino') . '</option>' ;            while( osc_has_list_regions() ) {			                   echo '<option value="' . osc_list_region_name() . '">' . osc_list_region_name() . '</option>' ;            }            echo '</select>' ;        }        View::newInstance()->_erase('list_regions') ;    }	function fino_region_select_items() {        if( osc_count_list_regions() > 0 ) {            echo '<select id="sRegion" name="sRegion">' ;			echo '<option value="">' . __('Select a region', 'fino') . '</option>' ;            while( osc_has_list_regions() ) {			                   echo '<option value="' . osc_list_region_name() . '">' . osc_list_region_name() . '</option>' ;            }            echo '</select>' ;        }    }	function fino_city_select() {        View::newInstance()->_exportVariableToView('list_cities', Search::newInstance()->listCities('%%%%', '>=', 'city_name ASC') ) ;        if( osc_count_list_cities() > 0 ) {            echo '<select id="sRegion" name="sCity">' ;			echo '<option value="">' . __('Select a city', 'fino') . '</option>' ;            while( osc_has_list_cities() ) {			                   echo '<option value="' . osc_list_city_name() . '">' . osc_list_city_name() . '</option>' ;            }            echo '</select>' ;        }        View::newInstance()->_erase('list_cities') ;    }	function fino_city_select_items() {        if( osc_count_list_cities() > 0 ) {            echo '<select id="sRegion" name="sCity">' ;			echo '<option value="">' . __('Select a city', 'fino') . '</option>' ;            while( osc_has_list_cities() ) {			                   echo '<option value="' . osc_list_city_name() . '">' . osc_list_city_name() . '</option>' ;            }            echo '</select>' ;        }    }	function fino_country_select() {        View::newInstance()->_exportVariableToView('list_countries', Search::newInstance()->listCountries('>=', 'country_name ASC') ) ;        if( osc_count_list_countries() > 0 ) {            echo '<select id="sRegion" name="sCountry">' ;			echo '<option value="">' . __('Select a country', 'fino') . '</option>' ;            while( osc_has_list_countries() ) {			                   echo '<option value="' . osc_list_country_name() . '">' . osc_list_country_name() . '</option>' ;            }            echo '</select>' ;        }        View::newInstance()->_erase('list_countries') ;    }	class fino_BodyClass {    private static $instance;    private $class;    private function __construct() {     $this->class = array();    }    public static function newInstance(){        if (  !self::$instance instanceof self)   {            self::$instance = new self;        }        return self::$instance;    }    public function add($class)   {        $this->class[] = $class;    }    public function get()   {        return $this->class;    }}class Fino_CategoryForm extends CategoryForm {static public function fino_category_select($categories, $category, $default_item = null, $name = "sCategory")        {            echo '<select name="' . $name . '" id="' . $name . '">';            if(isset($default_item)) {                echo '<option value="">' . $default_item . '</option>';            }            foreach($categories as $c) {                echo '<option value="' . $c['pk_i_id'] . '"' . ( ($category['pk_i_id'] == $c['pk_i_id']) ? 'selected="selected"' : '' ) . '>' . $c['s_name'] . '</option>';                if(isset($c['categories']) && is_array($c['categories'])) {                    CategoryForm::subcategory_select($c['categories'], $category, $default_item, 1);                }            }            echo '</select>';        }			}		function fino_categories_select($name = 'sCategory', $category = null, $default = null) {        if($default == null) $default = __('Category','fino');        Fino_CategoryForm::fino_category_select(Category::newInstance()->toTree(), $category, $default, $name);    }	function fino_search_region_select($class="", $default_item = null, $name = "sRegion",$region=null){			View::newInstance()->_exportVariableToView('list_regions', Search::newInstance()->listRegions('%%%%', '>=', 'region_name ASC') ) ;			if($default_item==null) $default_item = __('Select a region','fino');			if( osc_count_list_regions() > 0 ) {				echo '<select name="'.$name.'" id="'.$name.'" class="'.$class.' '.$name.'"  >' ;				if(isset($default_item) && $default_item!='') {					echo '<option value="">' . $default_item . '</option>';				}				while( osc_has_list_regions() ) {					echo '<option value="' . osc_list_region_id() . '" ' . ( ($region == osc_list_region_name()) ? 'selected="selected"' : '' ) . '>' . osc_list_region_name() . '</option>' ;				}				echo '</select>' ;			}			View::newInstance()->_erase('list_regions') ;		}	    if( !OC_ADMIN ) {        if( !function_exists('add_close_button_action') ) {            function add_close_button_action(){                echo '<script type="text/javascript">';                    echo '$(".flashmessage .ico-close").click(function(){';                        echo '$(this).parent().hide();';                    echo '});';                echo '</script>';            }            osc_add_hook('footer', 'add_close_button_action');        }    }    function theme_fino_actions_admin() {        if( Params::getParam('file') == 'oc-content/themes/fino/admin/settings.php' ) {            if( Params::getParam('donation') == 'successful' ) {                osc_set_preference('donation', '1', 'fino');                osc_reset_preferences();            }        }        switch( Params::getParam('action_specific') ) {            case('settings'):                $footerLink  = Params::getParam('footer_link');                $defaultLogo = Params::getParam('default_logo');                osc_set_preference('keyword_placeholder', Params::getParam('keyword_placeholder'), 'fino');                osc_set_preference('footer_link', ($footerLink ? '1' : '0'), 'fino');                osc_set_preference('default_logo', ($defaultLogo ? '1' : '0'), 'fino');				osc_set_preference('defaultShowAs@all', Params::getParam('defaultShowAs@all'), 'fino');				osc_set_preference('main-search',      trim(Params::getParam('main-search', false, false, false)),              'fino');				osc_set_preference('main-carousel',      trim(Params::getParam('main-carousel', false, false, false)),              'fino');                osc_set_preference('main-regcity',      trim(Params::getParam('main-regcity', false, false, false)),              'fino');				osc_set_preference('item-icon',      trim(Params::getParam('item-icon', false, false, false)),              'fino');				osc_set_preference('defaultShowAs@search', Params::getParam('defaultShowAs@all'));				osc_set_preference('finoColor@all', Params::getParam('finoColor@all'), 'fino');                osc_set_preference('inc-main',         trim(Params::getParam('inc-main', false, false, false)),                  'fino');				osc_set_preference('sub',         trim(Params::getParam('sub', false, false, false)),                  'fino');				osc_set_preference('mark-as',         trim(Params::getParam('mark-as', false, false, false)),                  'fino');				osc_set_preference('useful',         trim(Params::getParam('useful', false, false, false)),                  'fino');								if(is_numeric(Params::getParam('carousel_numads')))					osc_set_preference('carousel_numads', Params::getParam('carousel_numads'), 'fino');                osc_add_flash_ok_message(__('Theme settings updated correctly', 'fino'), 'admin');                header('Location: ' . osc_admin_render_theme_url('oc-content/themes/fino/admin/settings.php')); exit;            break;            case('upload_logo'):                $package = Params::getFiles('logo');                if( $package['error'] == UPLOAD_ERR_OK ) {                    if( move_uploaded_file($package['tmp_name'], WebThemes::newInstance()->getCurrentThemePath() . "img/logo.jpg" ) ) {                        osc_add_flash_ok_message(__('The logo image has been uploaded correctly', 'fino'), 'admin');                    } else {                        osc_add_flash_error_message(__("An error has occurred, please try again", 'fino'), 'admin');                    }                } else {                    osc_add_flash_error_message(__("An error has occurred, please try again", 'fino'), 'admin');                }                header('Location: ' . osc_admin_render_theme_url('oc-content/themes/fino/admin/header.php')); exit;            break;            case('remove'):                if(file_exists( WebThemes::newInstance()->getCurrentThemePath() . "img/logo.jpg" ) ) {                    @unlink( WebThemes::newInstance()->getCurrentThemePath() . "img/logo.jpg" );                    osc_add_flash_ok_message(__('The logo image has been removed', 'fino'), 'admin');                } else {                    osc_add_flash_error_message(__("Image not found", 'fino'), 'admin');                }                header('Location: ' . osc_admin_render_theme_url('oc-content/themes/fino/admin/header.php')); exit;            break;			case('ads_fino'):                osc_set_preference('main-finorevo-top',         trim(Params::getParam('main-finorevo-top', false, false, false)),                  'fino');                osc_set_preference('main-finorevo-under',       trim(Params::getParam('main-finorevo-under', false, false, false)),                'fino');                osc_set_preference('main-finorevo-middle',       trim(Params::getParam('main-finorevo-middle', false, false, false)),                'fino');                osc_set_preference('search-finorevo-top',     trim(Params::getParam('search-finorevo-top', false, false, false)),          'fino');                osc_set_preference('search-finorevo_middle',  trim(Params::getParam('search-finorevo_middle', false, false, false)),       'fino');				osc_set_preference('search-finorevo_under',  trim(Params::getParam('search-finorevo_under', false, false, false)),       'fino');				osc_set_preference('item-finorevo_desc',  trim(Params::getParam('item-finorevo_desc', false, false, false)),       'fino');				osc_set_preference('item-finorevo_image',  trim(Params::getParam('item-finorevo_image', false, false, false)),       'fino');				osc_set_preference('cat-finorevo',         trim(Params::getParam('cat-finorevo', false, false, false)),                  'fino');				osc_set_preference('side-finorevo',         trim(Params::getParam('side-finorevo', false, false, false)),                  'fino');				osc_set_preference('search-middle',  trim(Params::getParam('search-middle', false, false, false)),       'fino');				osc_set_preference('main-middle',  trim(Params::getParam('main-middle', false, false, false)),       'fino');                 osc_add_flash_ok_message(__("Settings updated correctly", 'fino'), 'admin');				osc_redirect_to(osc_admin_render_theme_url( 'oc-content/themes/fino/admin/settings.php#ads' ));			break;			 case('social_fino'):			 osc_set_preference('facebook-finorevo',         trim(Params::getParam('facebook-finorevo', false, false, false)),                  'fino');				osc_set_preference('twitter-finorevo',         trim(Params::getParam('twitter-finorevo', false, false, false)),                  'fino');				osc_set_preference('google-finorevo',         trim(Params::getParam('google-finorevo', false, false, false)),                  'fino');		       osc_add_flash_ok_message(__("Settings updated correctly", 'fino'), 'admin');				osc_redirect_to(osc_admin_render_theme_url( 'oc-content/themes/fino/admin/settings.php#social' ));			break;			case('items_fino'):			    osc_set_preference('item-post',         trim(Params::getParam('item-post', false, false, false)),                  'fino');				osc_set_preference('custom-fileds',         trim(Params::getParam('custom-fileds', false, false, false)),                  'fino');				osc_set_preference('search-title',  trim(Params::getParam('search-title', false, false, false)),       'fino');				osc_set_preference('main-title',  trim(Params::getParam('main-title', false, false, false)),       'fino');		        osc_add_flash_ok_message(__("Settings updated correctly", 'fino'), 'admin');				osc_redirect_to(osc_admin_render_theme_url( 'oc-content/themes/fino/admin/settings.php#items' ));			break;			case('related_fino'):		        osc_set_preference('related_fino_ra_numads'    	, '4','fino','INTEGER');	            osc_set_preference('related_fino_ra_category'   , '1','fino','INTEGER');				osc_add_flash_ok_message(__("Ads management updated correctly", 'fino'), 'admin');				osc_redirect_to(osc_admin_render_theme_url( 'oc-content/themes/fino/admin/settings.php#related' ));			break;			case('welcome_fino'):				osc_set_preference('mainh1-finorevo',         trim(Params::getParam('mainh1-finorevo', false, false, false)),                  'fino');				osc_set_preference('maintext-finorevo',         trim(Params::getParam('maintext-finorevo', false, false, false)),                  'fino');		        osc_add_flash_ok_message(__("Settings updated correctly", 'fino'), 'admin');				osc_redirect_to(osc_admin_render_theme_url( 'oc-content/themes/fino/admin/settings.php#welcome' ));			break;			case('category_icons'):					$catID = Params::getParam('category_id');					$package = Params::getFiles('category_icon');                if( $package['error'] == UPLOAD_ERR_OK ) {                    $img = ImageResizer::fromFile($package['tmp_name']);                    $path = osc_base_path().'oc-content/themes/fino/img/'.$catID.'.png' ;                    $img->saveToFile($path);                    osc_add_flash_ok_message(__('The icon has been uploaded correctly', 'fino'), 'admin');                } else {                    osc_add_flash_error_message(__("An error has occurred, please try again", 'fino'), 'admin');                }                osc_redirect_to(osc_admin_render_theme_url('oc-content/themes/fino/admin/settings.php#icons'));            break;			case('remove-icon'):				$catID = Params::getParam('category_id');                $path = osc_base_path().'oc-content/themes/fino/img/'.$catID.'.png' ;                if(file_exists( $path ) ) {                    @unlink( $path );                    osc_add_flash_ok_message(__('The icon has been removed', 'fino'), 'admin');                } else {                    osc_add_flash_error_message(__("Image not found", 'fino'), 'admin');                }                osc_redirect_to(osc_admin_render_theme_url('oc-content/themes/fino/admin/settings.php#icons'));            break;		}    }	osc_add_hook('init_admin', 'theme_fino_actions_admin');		if( !function_exists('fino_show_as') ){        function fino_show_as(){            $p_sShowAs    = Params::getParam('sShowAs');            $aValidShowAsValues = array('list', 'gallery');            if (!in_array($p_sShowAs, $aValidShowAsValues)) {                $p_sShowAs = fino_default_show_as();            }            return $p_sShowAs;        }    }		if( !function_exists('fino_catshow_as') ){        function fino_catshow_as(){            $p_sShowAs    = Params::getParam('inc-main');            $aValidShowAsValues = array('inc.main.category', 'inc.main.subcategory');            if (!in_array($p_sShowAs, $aValidShowAsValues)) {                $p_sShowAs = fino_category_main();            }            return $p_sShowAs;        }    }	if( !function_exists('fino_regcity_as') ){        function fino_regcity_as(){            $p_sShowAs    = Params::getParam('main-search');            $aValidShowAsValues = array('inc.search', 'inc.search.city', 'inc.search.hide');            if (!in_array($p_sShowAs, $aValidShowAsValues)) {                $p_sShowAs = fino_regioncity_main();            }            return $p_sShowAs;        }    }    if( !function_exists('fino_default_show_as') ){        function fino_default_show_as(){            return getPreference('defaultShowAs@all','fino');        }    }	if( !function_exists('fino_color') ){        function fino_color(){            return getPreference('finoColor@all','fino');        }    }	if( !function_exists('fino_category_main') ){        function fino_category_main(){            return getPreference('inc-main','fino');        }    }	if( !function_exists('fino_item_icon') ){        function fino_item_icon(){            return getPreference('item-icon','fino');        }    }	if( !function_exists('fino_mark-as') ){        function fino_mark(){            return getPreference('mark-as','fino');        }    }	if( !function_exists('fino_sub') ){        function fino_sub(){            return getPreference('sub','fino');        }    }	if( !function_exists('fino_useful') ){        function fino_useful(){            return getPreference('useful','fino');        }    }	if( !function_exists('fino_regioncity_main') ){        function fino_regioncity_main(){            return getPreference('main-search','fino');        }    }	if( !function_exists('fino_main_carousel') ){        function fino_main_carousel(){            $p_sShowAs    = Params::getParam('main-carousel');            $aValidShowAsValues = array('premium', 'popular', 'hide');            if (!in_array($p_sShowAs, $aValidShowAsValues)) {                $p_sShowAs = fino_main_carousel_as();            }            return $p_sShowAs;        }    }	if( !function_exists('fino_main_carousel_as') ){        function fino_main_carousel_as(){            return getPreference('main-carousel','fino');        }    }		if( !function_exists('get_categoriesHierarchy') ) {        function get_categoriesHierarchy( ) {            $location = Rewrite::newInstance()->get_location() ;            $section  = Rewrite::newInstance()->get_section() ;                        if ( $location != 'search' ) {                return false ;            }                        $category_id = osc_search_category_id() ;                        if(count($category_id) > 1) {                return false;            }                        $category_id = (int) $category_id[0] ;                        $categoriesHierarchy = Category::newInstance()->hierarchy($category_id) ;                        foreach($categoriesHierarchy as &$category) {                $category['url'] = get_category_url($category) ;            }                        return $categoriesHierarchy ;         }     }          if( !function_exists('get_subcategories') ) {         function get_subcategories( ) {             $location = Rewrite::newInstance()->get_location() ;             $section  = Rewrite::newInstance()->get_section() ;                         if ( $location != 'search' ) {                 return false ;             }                         $category_id = osc_search_category_id() ;                         if(count($category_id) > 1) {                 return false ;             }                         $category_id = (int) $category_id[0] ;                         $subCategories = Category::newInstance()->findSubcategories($category_id) ;                         foreach($subCategories as &$category) {                 $category['url'] = get_category_url($category) ;             }                         return $subCategories ;         }     }     if ( !function_exists('get_category_url') ) {         function get_category_url( $category ) {             $path = '';             if ( osc_rewrite_enabled() ) {                if ($category != '') {                    $category = Category::newInstance()->hierarchy($category['pk_i_id']) ;                    $sanitized_category = "" ;                    for ($i = count($category); $i > 0; $i--) {                        $sanitized_category .= $category[$i - 1]['s_slug'] . '/' ;                    }                    $path = osc_base_url() . $sanitized_category ;                }            } else {                $path = sprintf( osc_base_url(true) . '?page=search&sCategory=%d', $category['pk_i_id'] ) ;            }                        return $path;         }     }          if ( !function_exists('get_category_num_items') ) {         function get_category_num_items( $category ) {            $category_stats = CategoryStats::newInstance()->countItemsFromCategory($category['pk_i_id']) ;                        if( empty($category_stats) ) {                return 0 ;            }                        return $category_stats;         }     }	 if( !function_exists('fino_item_title') ) {        function fino_item_title() {            $title = osc_item_title();            foreach( osc_get_locales() as $locale ) {                if( Session::newInstance()->_getForm('title') != "" ) {                    $title_ = Session::newInstance()->_getForm('title');                    if( @$title_[$locale['pk_c_code']] != "" ){                        $title = $title_[$locale['pk_c_code']];                    }                }            }            return $title;        }    }    if( !function_exists('fino_item_description') ) {        function fino_item_description() {            $description = osc_item_description();            foreach( osc_get_locales() as $locale ) {                if( Session::newInstance()->_getForm('description') != "" ) {                    $description_ = Session::newInstance()->_getForm('description');                    if( @$description_[$locale['pk_c_code']] != "" ){                        $description = $description_[$locale['pk_c_code']];                    }                }            }            return $description;        }    }    if( !function_exists('logo_header') ) {        function logo_header() {            $html = '<img border="0" alt="' . osc_page_title() . '" src="' . osc_current_web_theme_url('img/logo.jpg') . '" />';            if( file_exists( WebThemes::newInstance()->getCurrentThemePath() . "img/logo.jpg" ) ) {                return $html;            } else if( osc_get_preference('default_logo', 'fino') && (file_exists( WebThemes::newInstance()->getCurrentThemePath() . "img/default-logo.jpg")) ) {                return '<img border="0" alt="' . osc_page_title() . '" src="' . osc_current_web_theme_url('img/default-logo.jpg') . '" />';            } else {                return osc_page_title();            }        }    }	if( !function_exists('fino_premium_parentcategory') ){        function fino_premium_parentcategory($categoryp){            $apCategory = osc_get_category('id',$categoryp);            $aparentCategory = osc_get_category('id', $apCategory['fk_i_parent_id']);           return $aparentCategory['pk_i_id'] ;        }    }   if (!function_exists('get_user_menu')) {    function get_user_menu() {        $options = array();        $options[] = array(		'name' => __('Public Profile', 'fino'), 		'url' => osc_user_public_profile_url(osc_logged_user_id()),		'class' => 'opt_publicprofile');        $options[] = array(            'name' => __('Listings', 'fino'),            'url' => osc_user_list_items_url(),            'class' => 'opt_items'        );        $options[] = array(            'name' => __('Alerts', 'fino'),            'url' => osc_user_alerts_url(),            'class' => 'opt_alerts'        );        $options[] = array(            'name' => __('Account', 'fino'),            'url' => osc_user_profile_url(),            'class' => 'opt_account'        );        $options[] = array(            'name' => __('Logout', 'fino'),            'url' => osc_user_logout_url(),            'class' => 'opt_logout'        );        return $options;    }}    // install update options    if( !function_exists('fino_theme_install') ) {        function fino_theme_install() {            osc_set_preference('keyword_placeholder', __('ie. car', 'fino'), 'fino');            osc_set_preference('version', '2.9.3', 'fino');            osc_set_preference('footer_link', true, 'fino');            osc_set_preference('donation', '0', 'fino');            osc_set_preference('default_logo', '1', 'fino');			osc_set_preference('defaultShowAs@all', 'gallery', 'fino');			osc_set_preference('finoColor@all', 'neptune', 'fino');			osc_set_preference('related_fino_ra_numads', '4','fino');			osc_set_preference('carousel_numads', '8','fino');			osc_set_preference('inc-main', 'inc.main.subcategory', 'fino');			osc_set_preference('main-search', 'inc.search', 'fino');			osc_set_preference('main-carousel', 'premium', 'fino');			osc_set_preference('main-regcity', 'regions', 'fino');			osc_set_preference('item-post', 'default', 'fino');			osc_set_preference('item-icon', 'enable', 'fino');			osc_set_preference('mark-as', 'enable', 'fino');			osc_set_preference('sub', 'enable', 'fino');			osc_set_preference('useful', 'enable', 'fino');			osc_set_preference('custom-fileds', 'bottom', 'fino');			osc_set_preference('search-middle', '5','fino');			osc_set_preference('main-middle', '5','fino');			osc_set_preference('facebook-finorevo', 'https://www.facebook.com/osclassprocom','fino');			osc_set_preference('twitter-finorevo', 'https://twitter.com/osclass_pro_com','fino');			osc_set_preference('google-finorevo', 'https://plus.google.com/107706977667016834969','fino');			osc_set_preference('search-title', '50','fino');			osc_set_preference('main-title', '70','fino');            osc_reset_preferences();        }    }    if(!function_exists('check_install_fino_theme')) {        function check_install_fino_theme() {            $current_version = osc_get_preference('version', 'fino');            //check if current version is installed or need an update            if( !$current_version ) {                fino_theme_install();            }        }    }    check_install_fino_theme();	/* ads  SEARCH */    function search_ads_listing_top_finorevo() {        if(osc_get_preference('search-finorevo-top', 'fino')!='') {            echo '<div class="search_top">' . PHP_EOL;            echo osc_get_preference('search-finorevo-top', 'fino');            echo '</div>' . PHP_EOL;        }    }    osc_add_hook('search_top', 'search_ads_listing_top_finorevo');		function search_ads_listing_under_finorevo() {        if(osc_get_preference('search-finorevo_under', 'fino')!='') {            echo '<div class="clear"></div>' . PHP_EOL;            echo '<div class="search_under">' . PHP_EOL;            echo osc_get_preference('search-finorevo_under', 'fino');            echo '</div>' . PHP_EOL;        }    }    osc_add_hook('search_under', 'search_ads_listing_under_finorevo');    function main_ads_listing_medium_finorevo() {        if(osc_get_preference('main-finorevo-middle', 'fino')!='') {            echo '<div class="clear"></div>' . PHP_EOL;            echo '<div class="middle_main">' . PHP_EOL;            echo osc_get_preference('main-finorevo-middle', 'fino');            echo '</div>' . PHP_EOL;        }    }    osc_add_hook('main_middle', 'main_ads_listing_medium_finorevo');		function search_ads_listing_medium_finorevo() {        if(osc_get_preference('search-finorevo_middle', 'fino')!='') {            echo '<div class="clear"></div>' . PHP_EOL;            echo '<div class="middle_search">' . PHP_EOL;            echo osc_get_preference('search-finorevo_middle', 'fino');            echo '</div>' . PHP_EOL;        }    }    osc_add_hook('search_middle', 'search_ads_listing_medium_finorevo');    /* remove theme */  function fino_delete() {Preference::newInstance()->delete(array('s_section' => 'fino'));    }osc_add_hook('theme_delete_fino', 'fino_delete');if( !function_exists('fino_carousel_num_ads') ) {		function fino_carousel_num_ads() {			return(osc_get_preference('carousel_numads', 'fino')) ;		}	}	function fino_popular_ads_start() {			$num_ads = fino_carousel_num_ads(); // SETS HOW MANY POPULAR ADS TO DISPLAY			 $conn = getConnection();          $item_array=$conn->osc_dbFetchResults("SELECT i.*, l.*, t.*, total_views    FROM %st_item i    JOIN %st_item_location l ON i.pk_i_id = l.fk_i_item_id	JOIN %st_item_description t ON i.pk_i_id = t.fk_i_item_id    join (select fk_i_item_id as pk_i_id, sum(i_num_views) as total_views    from %st_item_stats    group by fk_i_item_id    having total_views > 0 ) as aux_item_views on aux_item_views.pk_i_id = i.pk_i_id    WHERE i.b_enabled = 1 AND i.b_active = 1 AND i.b_spam = 0 AND (i.b_premium = 1 || i.dt_expiration >= CURDATE())    ORDER BY total_views DESC    LIMIT 0, %d", DB_TABLE_PREFIX, DB_TABLE_PREFIX, DB_TABLE_PREFIX, DB_TABLE_PREFIX, $num_ads);    if(count($item_array) > 0) {	View::newInstance()->_exportVariableToView('customItems', $item_array);    } }    function osc_related_fino_ra_numads() {        return(osc_get_preference('related_fino_ra_numads', 'fino')) ;    }        function osc_related_fino_category() {        return(osc_get_preference('related_fino_ra_category', 'fino')) ;    }        function osc_related_fino_country() {        return(osc_get_preference('related_fino_ra_country', 'fino')) ;    }        function osc_related_fino_region() {        return(osc_get_preference('related_fino_ra_region', 'fino')) ;    }        function osc_related_fino_picOnly() {        return(osc_get_preference('related_fino_picOnly', 'fino')) ;    }        function osc_related_fino_css() {    	return(osc_get_preference('related_fino_css', 'fino')) ;    }        function osc_related_fino_autoembed() {    	return(osc_get_preference('related_fino_autoembed', 'fino')) ;    }    function osc_related_fino_premiumOnly() {    	return(osc_get_preference('related_fino_premiumonly', 'fino')) ;    }//function to show related Ads    	 function related_fino_start() {    $rmItemId = osc_item_id() ;    $ra_numads = (osc_related_fino_ra_numads() != '') ? osc_related_fino_ra_numads() : '' ;    $country = (osc_related_fino_country() != '') ? osc_related_fino_country() : '' ;    $region = (osc_related_fino_region() != '') ? osc_related_fino_region() : '' ;    $category = (osc_related_fino_category() != '') ? osc_related_fino_category() : '' ;    $picOnly = (osc_related_fino_picOnly() != '') ? osc_related_fino_picOnly() : '';     $premiumonly = (osc_related_fino_premiumOnly() != '') ? osc_related_fino_premiumOnly() : '';        $mSearch = new Search() ;        //Excluding current item    $mSearch->dao->where(sprintf("%st_item.pk_i_id <> $rmItemId", DB_TABLE_PREFIX));        //Checking if item is premium    if($premiumonly ==1){    $mSearch->dao->where(sprintf("%st_item.b_premium = 1", DB_TABLE_PREFIX));    }        //Adding Country as condition    if($country ==1){    $mSearch->addCountry(osc_item_country()) ;    }        //Adding Region as condition    if($region ==1) {    $mSearch->addRegion(osc_item_region()) ;    }        //Adding Item Category as condition    if($category ==1) {    $mSearch->addCategory(osc_item_category_id()) ;    }        //Adding condition for item having pictures    if($picOnly == 1 ) {    $mSearch->withPicture(true); //Search only Item which have pictures    }        //limiting number of related ads    $mSearch->limit(0, $ra_numads) ; // fetch number of ads to show set in preference        //Searching with all enabled conditions    $aItems = $mSearch->doSearch();     		$global_items = View::newInstance()->_get('items') ; //save existing item array	View::newInstance()->_exportVariableToView('items', $aItems); //exporting our searched item array    require_once WebThemes::newInstance()->getCurrentThemePath() . 'related_fino_ads.php';       //calling stored item array    View::newInstance()->_exportVariableToView('items', $global_items); //restore original item array    }		osc_add_hook('init_admin', 'theme_fino_actions_admin');function fino_is_fineuploader() {    return Scripts::newInstance()->registered['jquery-fineuploader'] && method_exists('ItemForm', 'ajax_photos');}if (function_exists('osc_admin_menu_appearance')) {    osc_admin_menu_appearance(__('Header logo', 'fino'), osc_admin_render_theme_url('oc-content/themes/fino/admin/header.php'), 'header_fino');    osc_admin_menu_appearance(__('Theme settings', 'fino'), osc_admin_render_theme_url('oc-content/themes/fino/admin/settings.php'), 'settings_fino');} else {    function fino_admin_menu() {        echo '<h3><a href="#">' . __('Fino theme', 'fino') . '</a></h3>            <ul>                <li><a href="' . osc_admin_render_theme_url('oc-content/themes/fino/admin/header.php') . '">&raquo; ' . __('Header logo', 'fino') . '</a></li>                <li><a href="' . osc_admin_render_theme_url('oc-content/themes/fino/admin/settings.php') . '">&raquo; ' . __('Theme settings', 'fino') . '</a></li>		   </ul>';    }    osc_add_hook('admin_menu', 'fino_admin_menu');}function fino_user_type() {  if(Params::getParam('sCompany') <> '' and Params::getParam('sCompany') <> null) {    Search::newInstance()->addJoinTable( 'pk_i_id', DB_TABLE_PREFIX.'t_user', DB_TABLE_PREFIX.'t_item.fk_i_user_id = '.DB_TABLE_PREFIX.'t_user.pk_i_id', 'LEFT OUTER' ) ;     if(Params::getParam('sCompany') == 1) {      Search::newInstance()->addConditions(sprintf("%st_user.b_company = 1", DB_TABLE_PREFIX));    } else {      Search::newInstance()->addConditions(sprintf("coalesce(%st_user.b_company, 0) <> 1", DB_TABLE_PREFIX, DB_TABLE_PREFIX));    }  }}osc_add_hook('search_conditions', 'fino_user_type');function fino_category_root( $category_id ) {  $category = Category::newInstance()->findRootCategory( $category_id );  $catid = $category['pk_i_id'];  return $catid;}?>